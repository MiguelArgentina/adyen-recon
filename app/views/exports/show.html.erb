<div data-controller="export-poll" data-export-poll-status-value="<%= @export.status %>" data-export-poll-export-id-value="<%= @export.id %>">
  <h1 class="text-lg font-semibold mb-2">Export</h1>
  <p class="text-sm text-slate-600 mb-6">
    <strong>Kind:</strong> <%= @export.kind.humanize %> ·
    <strong>Status:</strong> <%= status_badge(@export.status) %> ·
    <strong>Period:</strong> <%= @export.period_start %> – <%= @export.period_end %>
    <% if @row_count %> · <strong>Rows:</strong> <%= @row_count %><% end %>
  </p>

  <% if @export.generated? %>
    <div class="card space-y-4">
      <div class="flex items-center justify-between">
        <div class="font-medium">Export generated</div>
        <%= link_to "Download CSV", download_export_path(@export), class: "btn btn-primary" %>
      </div>
      <p class="text-sm text-slate-600">The CSV file is ready. Stored on server path below.</p>
      <pre class="text-xs bg-white border border-[color:var(--surface-border)] rounded-xl p-3 overflow-x-auto"><%= @export.file_path %></pre>
    </div>
  <% elsif @export.failed? %>
    <div class="card" style="background: var(--error-bg); border-color: var(--error-brd); color: var(--error-fg);">
      <div class="font-medium mb-2">Generation failed</div>
      <pre class="text-xs bg-white/70 border border-[color:var(--error-brd)] rounded-xl p-3 overflow-x-auto"><%= @export.error %></pre>
      <div>
        <%= link_to "Retry", new_export_path, class: "btn btn-secondary mt-2" %>
      </div>
    </div>
  <% else %>
    <div class="card">
      <div class="flex items-start justify-between">
        <div>
          <div class="font-medium mb-1">Export queued or processing…</div>
          <p class="text-sm text-slate-600">Refresh this page in a moment; it will update once generated.</p>
        </div>
        <%= link_to "Refresh", export_path(@export), class: "btn btn-ghost" %>
      </div>
    </div>
  <% end %>

  <% if @export.generated? && (@row_count == 0) %>
    <div class="callout mt-4">
      <i class="fa fa-circle-info icon icon-primary"></i>
      <div>This export contains only a header (no data rows for the selected period).</div>
    </div>
  <% end %>

  <div class="mt-6 flex gap-3">
    <%= link_to "All Exports", exports_path, class: "btn btn-secondary" %>
    <%= link_to "New Export", new_export_path, class: "btn btn-ghost" %>
    <%= link_to "Uploads", report_files_path, class: "btn btn-ghost" %>
  </div>
</div>
